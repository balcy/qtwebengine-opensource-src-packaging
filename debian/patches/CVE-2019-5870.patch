Description: add more checks in MojoCdmService
Origin: upstream, https://code.qt.io/cgit/qt/qtwebengine-chromium.git/commit/?id=55e2f9a305cce473
Last-Update: 2019-12-19

--- a/src/3rdparty/chromium/media/mojo/services/mojo_cdm_service.cc
+++ b/src/3rdparty/chromium/media/mojo/services/mojo_cdm_service.cc
@@ -62,7 +62,9 @@ void MojoCdmService::Initialize(const st
                                 const CdmConfig& cdm_config,
                                 InitializeCallback callback) {
   DVLOG(1) << __func__ << ": " << key_system;
-  DCHECK(!cdm_);
+
+  CHECK(!has_initialize_been_called_) << "Initialize should only happen once";
+  has_initialize_been_called_ = true;
 
   auto weak_this = weak_factory_.GetWeakPtr();
   cdm_factory_->Create(
@@ -156,6 +158,7 @@ void MojoCdmService::OnCdmCreated(
     return;
   }
 
+  CHECK(!cdm_) << "CDM should only be created once.";
   cdm_ = cdm;
 
   if (context_) {
--- a/src/3rdparty/chromium/media/mojo/services/mojo_cdm_service.h
+++ b/src/3rdparty/chromium/media/mojo/services/mojo_cdm_service.h
@@ -100,6 +100,8 @@ class MEDIA_MOJO_EXPORT MojoCdmService :
   // Callback for when |decryptor_| loses connectivity.
   void OnDecryptorConnectionError();
 
+  bool has_initialize_been_called_ = false;
+
   CdmFactory* cdm_factory_;
   MojoCdmServiceContext* const context_ = nullptr;
   scoped_refptr<::media::ContentDecryptionModule> cdm_;
